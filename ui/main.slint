import { AboutSlint, Button, VerticalBox, Palette, ScrollView, HorizontalBox } from "std-widgets.slint";
import { DisplayLimits, AppFonts } from "./common.slint";
import { O2Page } from "o2_page.slint";

component Carousel inherits FocusScope {
    in-out property <int> selected-index;
    in property <length> spacing;
    in property <length> itemWidth;
    in property <int> count: 0;

    callback move-right();
    callback move-left();
    callback move-focus-up();

    move-right => {
        root.selected-index = min(root.selected-index + 1, root.count - 1);
    }

    move-left => {
        root.selected-index = max(root.selected-index - 1, 0);
    }

    private property <length> center-x: (root.width - 240px) / 2;
    private property <duration> duration: 0.3s;

    Rectangle {
        clip: true;
        background: transparent;

        flickable := Flickable {
            interactive: false;
            viewport-x: root.center-x - root.selected-index * (root.itemWidth + root.spacing);

            animate viewport-x {
                duration: root.duration;
                easing: ease-in;
            }

            TouchArea {
                property <length> last-mouse-x: 0px;

                pointer-event(event) => {

                    if (event.kind == PointerEventKind.down) {
                        last-mouse-x = self.mouse-x;
                    } else if (event.kind == PointerEventKind.up) {

                        if (last-mouse-x > self.mouse-x) {
                            root.move-right();
                        } else {
                            root.move-left();
                        }
                    }
                }
            }

            HorizontalLayout {
                @children
            }
        }
    }
}

export component AppWindow inherits Window {
    in-out property <float> o2-lambda-reading: 1.000;

    width: 240px;
    height: 240px;
    padding: 0;

    Image {
        source: @image-url("./assets/background_1.jpg");
    }

    DisplayLimits {

        i-carousel := Carousel {
            y: (root.height - self.height) / 2;
            height: 100%;
            itemWidth: 240px;
            count: 5;
            spacing: 0px;

            Rectangle {
                width: 240px;
                height: 240px;

                if(i-carousel.selected-index <= 1): O2Page {
                    o2-lambda-reading: root.o2-lambda-reading;
                }
            }

            HorizontalLayout {
                width: 240px;
                alignment: center;

                VerticalLayout {
                    alignment: center;
                    Text {
                        text: "Gauge 2";
                        font-size: 24px;
                    }
                }
            }

            HorizontalLayout {
                width: 240px;
                alignment: center;

                VerticalLayout {
                    alignment: center;
                    Text {
                        text: "Gauge 3";
                        font-size: 24px;
                    }
                }
            }

            HorizontalLayout {
                width: 240px;
                alignment: center;

                VerticalLayout {
                    alignment: center;
                    Text {
                        text: "Gauge 4";
                        font-size: 24px;
                    }
                }
            }

            ScrollView {
                viewport-height: 420px;
                viewport-width: 240px;
                height: 240px;
                width: 240px;

                VerticalLayout {
                    padding-top: 64px;
                    padding-bottom: 64px;

                    AboutSlint {
                        width: 100%;
                    }

                    Text {
                        text: "Ferris the\nrustacean";
                        horizontal-alignment: center;
                        font-size: 24px;
                    }

                    Image {
                        width: 100%;
                        height: 100px;
                        source: @image-url("./assets/rustacean-flat-happy.png");
                    }
                }
            }
        }
    }
}
